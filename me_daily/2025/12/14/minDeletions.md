# é¢˜æ„é€Ÿè®°

ç»™å®šåªåŒ…å« `A/B` çš„å­—ç¬¦ä¸² `s`ï¼Œæ”¯æŒä¸¤ç§æ“ä½œï¼š

1. **ç¿»è½¬**æŸä¸ªä¸‹æ ‡ `j` çš„å­—ç¬¦ï¼ˆAâ†”Bï¼‰
    
2. **æŸ¥è¯¢**åŒºé—´ `[l, r]`ï¼Œæ±‚æœ€å°‘åˆ é™¤å¤šå°‘å­—ç¬¦ï¼Œä½¿å­ä¸²å˜æˆ**äº¤æ›¿å­—ç¬¦ä¸²**ï¼ˆç›¸é‚»å­—ç¬¦ä¸åŒï¼‰
    

æ ¸å¿ƒéš¾ç‚¹ï¼š

- ä¿®æ”¹æ˜¯**å•ç‚¹ç¿»è½¬**ï¼Œä½†ä¼šå½±å“ç›¸é‚»å…³ç³»
    
- æŸ¥è¯¢åŒºé—´å¾ˆå¤šï¼Œéœ€è¦ **O(log n)**
    

---

# å…³é”®è§‚å¯Ÿï¼ˆéå¸¸é‡è¦ï¼‰

## 1ï¸âƒ£ äº¤æ›¿å­—ç¬¦ä¸² = ç›¸é‚»å­—ç¬¦éƒ½ä¸åŒ

å¯¹äºåŒºé—´ `[l, r]`ï¼š

- å¦‚æœæˆ‘ä»¬çŸ¥é“å…¶ä¸­æœ‰å¤šå°‘å¯¹**ç›¸é‚»å­—ç¬¦ä¸åŒ**
    
- é‚£ä¹ˆæœ€é•¿äº¤æ›¿å­åºåˆ—é•¿åº¦ï¼ˆè¿ç»­ï¼‰ä¸ºï¼š
    

```
LAS = 1 + ç›¸é‚»ä¸åŒçš„æ¬¡æ•°
```

æœ€å°‘åˆ é™¤æ•°ï¼š

```
(r - l + 1) - LAS
```

æ‰€ä»¥é—®é¢˜å˜æˆï¼š

> **åŠ¨æ€ç»´æŠ¤ï¼šç›¸é‚»å­—ç¬¦æ˜¯å¦ä¸åŒ**

---

# ä¸¤ç§ç­‰ä»·çš„ bad / trans å®šä¹‰


---

## âœ… å®šä¹‰ Aï¼ˆä½ ä¸€å¼€å§‹ç”¨çš„ï¼‰

```text
bad[i] = 1  å¦‚æœ s[i] == s[i-1]
```

- i ä» 1 åˆ° n-1
    
- è¡¨ç¤ºâ€œç¬¬ i ä½æ˜¯å¦ç ´åäº¤æ›¿â€
    

åŒºé—´ `[l, r]` ä¸­ï¼š

```text
éœ€è¦ç»Ÿè®¡ bad[l+1 ... r]
```

---

## âœ… å®šä¹‰ Bï¼ˆ C++ è§£æ³•ï¼‰

```text
trans[i] = 1  å¦‚æœ s[i] != s[i+1]
```

- i ä» 0 åˆ° n-2
    
- è¡¨ç¤ºâ€œç¬¬ i å’Œ i+1 æ˜¯å¦æˆåŠŸäº¤æ›¿â€
    

åŒºé—´ `[l, r]` ä¸­ï¼š

```text
trans_sum = sum(trans[l ... r-1])
LAS = 1 + trans_sum
```

ğŸ“Œ **ä¸¤è€…åªæ˜¯ä¸‹æ ‡å¹³ç§»ï¼Œæœ¬è´¨ä¸€è‡´**

---

# ä¸ºä»€ä¹ˆä¿®æ”¹åªå½±å“ 2 ä¸ªä½ç½®ï¼Ÿ

ç¿»è½¬ `s[j]`ï¼š

åŸæ¥å—å½±å“çš„ç›¸é‚»å…³ç³»åªæœ‰ï¼š

- `(j-1, j)`
    
- `(j, j+1)`
    

å…¶ä»–ä½ç½®ï¼š

- è¦ä¹ˆä¸åŒ…å« `s[j]`
    
- è¦ä¹ˆæ¯”è¾ƒçš„å­—ç¬¦æ²¡å˜
    

âœ… æ‰€ä»¥ï¼š

> **æ¯æ¬¡ä¿®æ”¹åªéœ€è¦æ›´æ–°æœ€å¤š 2 ä¸ª Fenwick ä¸‹æ ‡**

---

# Fenwick æ ‘é‡Œå­˜ä»€ä¹ˆï¼Ÿ

æˆ‘ä»¬å­˜çš„æ˜¯ï¼š

```cpp
trans[i] = (s[i] != s[i+1]) ? 1 : 0
```

Fenwick ç»´æŠ¤çš„æ˜¯ï¼š

- å‰ç¼€ä¸­ã€ŒæˆåŠŸäº¤æ›¿ã€çš„æ¬¡æ•°
    

---

# ä¿®æ”¹æ“ä½œï¼ˆæœ€å®¹æ˜“å†™é”™çš„åœ°æ–¹ï¼‰

```cpp
char old = s[j];
s[j] = (old == 'A' ? 'B' : 'A');
```

### å½±å“ 1ï¼š`j-1, j`

```cpp
if (j > 0) {
    int pos = j - 1;
    old_trans = (s[pos] != old);
    new_trans = (s[pos] != s[j]);
    ft.update(pos, new_trans - old_trans);
}
```

### å½±å“ 2ï¼š`j, j+1`

```cpp
if (j < n - 1) {
    int pos = j;
    old_trans = (old != s[j+1]);
    new_trans = (s[j] != s[j+1]);
    ft.update(pos, new_trans - old_trans);
}
```

ğŸ“Œ **ä¸€å®šæ˜¯â€œæ–° - æ—§â€**ï¼Œä¸æ˜¯ç›´æ¥ set

---

# æŸ¥è¯¢æ“ä½œ

```cpp
int len = r - l + 1;
if (len == 1) return 0;

int trans_sum = ft.range(l, r - 1);
int LAS = 1 + trans_sum;
answer = len - LAS;
```

ä¸ºä»€ä¹ˆæ˜¯ `[l, r-1]`ï¼Ÿ

- å› ä¸º `trans[i]` æ¯”è¾ƒçš„æ˜¯ `i` å’Œ `i+1`
    

---

# å¸¸è§å‘æ€»ç»“

- âŒ Fenwick ä¸‹æ ‡ 0/1 æ··ä¹±
    
- âŒ update å¿˜è®°å‡æ—§å€¼
    
- âŒ æŸ¥è¯¢åŒºé—´å†™æˆ `[l, r]`
    
- âŒ ä¿®æ”¹æ—¶å¿˜äº†åªå½±å“ 2 ä¸ªä½ç½®
    



