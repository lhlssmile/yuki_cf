# Codeforces 2147D - Maximize the Root

## 题目链接
[Codeforces 2147D](https://codeforces.com/problemset/problem/2147/D)

## 题目理解

Alice 和 Bob 轮流进行游戏，Alice 先手。每轮游戏中：
1. 玩家选择一个当前数组中存在的值 x > 0
2. 玩家获得数组中所有等于 x 的元素个数的分数
3. 数组中所有等于 x 的元素都减 1
4. 游戏继续直到数组中所有元素都变为 0

双方都采用最优策略，求最终 Alice 和 Bob 各自的得分。

## 核心观察

### 关键洞察
1. **分层思考**：对于每个值 h，它会被"消耗" h 次（从 h 减到 0）
2. **贡献分析**：值为 h 且出现 f 次的数字，总共会贡献 h × f 分
3. **奇偶性质**：对于偶数高度，Alice 和 Bob 平分收益；对于奇数高度，先手（Alice）多得一次

### 策略分解
- **基础分数（base）**：每个值 h 的前 ⌊h/2⌋ 轮，Alice 和 Bob 各得 ⌊h/2⌋ × f 分
- **额外分数（extras）**：对于奇数高度 h，Alice 比 Bob 多得 f 分

## 算法思路

### 核心策略
1. **统计频次**：用 map 统计每个值的出现次数
2. **计算基础分**：对于每个值 h 出现 f 次，双方各得 (h/2) × f 分
3. **处理奇数值**：收集所有奇数高度对应的频次
4. **贪心分配**：将奇数频次按降序排列，Alice 和 Bob 轮流选择最大的

### 算法步骤
```cpp
// 1. 统计频次
map<ll, ll> freq;
for (ll x : a) ++freq[x];

// 2. 计算基础分和收集奇数频次
ll base = 0;
vector<ll> extras;
for (auto& p : freq) {
    ll h = p.first, f = p.second;
    base += (h / 2) * f;  // 双方平分的部分
    if (h % 2 == 1) extras.push_back(f);  // 奇数高度的额外分
}

// 3. 贪心分配额外分数
sort(extras.rbegin(), extras.rend());
ll alice_extra = 0, bob_extra = 0;
for (size_t i = 0; i < extras.size(); ++i) {
    if (i % 2 == 0) alice_extra += extras[i];
    else bob_extra += extras[i];
}

// 4. 计算最终得分
ll alice = base + alice_extra;
ll bob = base + bob_extra;
```

## 算法正确性

### 为什么这样分配是最优的？

1. **基础分数的必然性**：
   - 对于高度为偶数 2k 的值，必然会有 k 轮 Alice 选择，k 轮 Bob 选择
   - 无论选择顺序如何，双方都会平分这部分收益

2. **奇数高度的争夺**：
   - 对于高度为奇数 2k+1 的值，会有 k+1 轮和 k 轮的分配
   - 先手 Alice 总是能获得多出来的那一轮
   - 关键在于 Alice 应该优先争夺频次更高的奇数值

3. **贪心策略的最优性**：
   - Alice 和 Bob 都会优先选择能获得更多分数的奇数值
   - 按频次降序分配确保了双方都采用最优策略

## 复杂度分析

- **时间复杂度**：O(n log n)
  - 统计频次：O(n log n)（map 操作）
  - 排序额外分数：O(k log k)，其中 k 是不同奇数值的个数
  - 总体：O(n log n)

- **空间复杂度**：O(n)
  - map 存储：O(k)，k 为不同值的个数
  - extras 数组：O(k)

## 关键观察

### 数学本质
1. **分层博弈**：每个高度层都是独立的博弈
2. **奇偶分离**：偶数层平分，奇数层先手优势
3. **贪心最优**：在奇数层的争夺中，优先选择收益最大的

### 实现细节
1. **数据类型**：使用 `long long` 防止溢出
2. **排序方向**：`rbegin()` 实现降序排列
3. **轮流分配**：通过索引的奇偶性实现轮流选择

## 算法模板意义

这道题展示了博弈论中的重要思想：
1. **问题分解**：将复杂博弈分解为独立的子问题
2. **奇偶分析**：利用奇偶性质简化博弈分析
3. **贪心策略**：在局部最优选择中实现全局最优
4. **数学建模**：将游戏规则转化为数学计算

这种分析方法在处理类似的轮流博弈问题时非常有效。